language: node_js
branches:
  only:
    - master
node_js:
  - 12.13.1
env:
  - NODE_ENV=PRODUCTION
before_install:
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.19.2
  - export PATH="$HOME/.yarn/bin:$PATH"
before_script:
  - cd frontend-payment
  - rm -rf node_modules
  - yarn --frozen-lockfile
  - yarn build
  - cd ..
  - rm -rf backend-core/frontend-dist/
  - cp -R frontend-payment/build/ backend-core/frontend-dist/
  - cd backend-core
  - rm -rf node_modules
  - yarn --frozen-lockfile
  - yarn build
  - cd ..
script:
  - echo "There are no tests"
cache:
  directories:
    - "$HOME/.cache/yarn"
    - "$HOME/.npm"
before_deploy:
  - cd backend-core
deploy:
  skip_cleanup: true
  provider: heroku
  api_key:
    secure: todo
  app: bandmateclub
  on:
    repo: bandmateclub/bandmateclub
